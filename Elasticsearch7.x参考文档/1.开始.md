[**Elasticsearch**](https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started.html#getting-started)（以下简称：**ES**)是一个高度可伸缩的开源全文搜索和分析引擎。它允许您快速、实时地存储、搜索和分析大量数据。它通常用作底层引擎/技术，为具有复杂搜索特性和需求的应用程序提供动力。

#### ES应用场景

1. 您运行一个在线web商店，允许您的客户搜索您销售的商品。在这种情况下，您可以使用Elasticsearch来存储整个商品目录和库存，并为它们提供搜索和自动完成建议。
2. 您希望收集日志或事务数据，并希望分析和挖掘这些数据，以寻找趋势、统计、摘要或异常。在本例中，您可以使用Logstash (Elasticsearch/Logstash/Kibana堆栈的一部分)来收集、聚合和解析数据，然后让Logstash将这些数据提供给Elasticsearch。一旦数据在Elasticsearch中，您就可以运行搜索和聚合来挖掘您感兴趣的任何信息。
3. 你运行一个价格提醒平台，允许价格精明的客户指定一条规则，比如“我有兴趣购买特定的电子产品，如果某个供应商的电子产品价格在下个月内跌破X美元，我希望得到通知”。在这种情况下，您可以抓取供应商的价格，将其推入Elasticsearch，并使用其反向搜索(Percolator)功能来匹配针对客户查询的价格移动，最终在找到匹配后将警报推送给客户。
4. 您有分析/业务智能需求，并且希望快速地调查、分析、可视化和针对大量数据(想想数百万或数十亿条记录)提出特别的问题。在本例中，您可以使用Elasticsearch来存储数据，然后使用Kibana (Elasticsearch/Logstash/Kibana堆栈的一部分)构建自定义仪表板，该仪表板可以可视化对您重要的数据方面。此外，还可以使用Elasticsearch聚合功能对数据执行复杂的业务智能查询。

#### 基本概念

1. **近乎实时（Near Realtime，NRT）**

Elasticsearch是一个近乎实时的搜索平台，意思是从索引文档到可搜索文档之间有一个轻微的延迟(通常是一秒钟)。

2. **集群（Cluster）**

集群是一个或多个节点(服务器)的集合，它们一起保存您的整个数据，并跨所有节点提供联合索引和搜索功能。集群由一个惟一的名称标识，默认情况下该名称是“elasticsearch”。这个名称很重要，因为只有将节点设置为按其名称加入集群时，节点才能成为集群的一部分。

确保不要在不同的环境中重用相同的集群名称，否则可能会导致节点加入错误的集群。例如，您可以对开发、登台和生产集群使用logging-dev、logging-stage和logging-prod。

请注意，只有一个节点的集群是有效的，而且非常好。此外，您还可以拥有多个独立的集群，每个集群都有自己独特的集群名称。

3. **节点（Node）**

节点是一个服务器，它是集群的一部分，存储数据，并参与集群的索引和搜索功能。与集群一样，节点也是通过名称来标识的，默认情况下，名称是在启动时分配给节点的随机全局惟一标识符(UUID)。如果不需要缺省值，可以定义任何需要的节点名称。对于您想要标识网络中的哪些服务器对应于Elasticsearch集群中的哪些节点的管理目的，这个名称非常重要。

可以通过集群名称将节点配置为连接特定的集群。默认情况下，每个节点都被设置为加入一个名为elasticsearch的集群，这意味着如果您启动网络上的多个节点——假设它们能够彼此发现——它们将自动形成并加入一个名为elasticsearch的集群。

在单个集群中，您可以拥有任意多的节点。此外，如果您的网络上没有其他运行的Elasticsearch节点，那么默认情况下，启动单个节点将形成一个名为Elasticsearch的新单节点集群。

4. **索引（Index）**

索引是具有某种类似特征的文档集合。例如，可以为客户数据建立索引，为产品目录建立另一个索引，为订单数据建立另一个索引。索引由名称标识(必须全部为小写)，当对其中的文档执行索引、搜索、更新和删除操作时，此名称用于引用索引。

在一个集群中，您可以定义任意多的索引。

5. **文档（Document）**

文档是可以建立索引的基本信息单元。例如，您可以为单个客户创建一个文档，为单个产品创建另一个文档，为单个订单创建另一个文档。该文档用JSON (JavaScript对象表示法)表示，这是一种无处不在的internet数据交换格式。在索引中，可以存储任意数量的文档。

6. **分片和副本（Shards&Replicas）**

索引可能存储大量数据，这些数据可能超过单个节点的硬件限制。例如，一个包含10亿个文档的索引占用1TB的磁盘空间，这个索引可能不适用于单个节点的磁盘，或者速度太慢，无法满足单个节点的搜索请求。

为了解决这个问题，Elasticsearch提供了将索引细分为多个碎片的功能。创建索引时，可以简单地定义所需的碎片数量。每个碎片本身都是一个功能齐全且独立的“索引”，可以托管在集群中的任何节点上。

分片之所以重要，主要有两个原因:

* 它允许您水平分割/缩放内容卷

* 它允许您在分片上(可能在多个节点上)分布式和并行化操作，从而提高性能/吞吐量

碎片如何分布以及如何将其文档聚合回搜索请求的机制完全由Elasticsearch管理，并且对用户是透明的。

在随时可能出现故障的网络/云环境中，如果碎片/节点由于某种原因离线或消失，那么使用故障转移机制是非常有用的，强烈建议使用这种机制。为此，Elasticsearch允许您将索引碎片的一个或多个副本复制为所谓的复制碎片，或简称为副本。

副本之所以重要，主要有两个原因:

* 它在碎片/节点失败时提供高可用性。出于这个原因，需要注意的是，副本碎片永远不会与复制它的原始/主碎片分配在相同的节点上。

* 它允许您扩展搜索量/吞吐量，因为可以在所有副本上并行执行搜索。

总而言之，每个索引可以分成多个碎片。索引也可以被复制零次(即没有副本)或多次。复制后，每个索引将具有主碎片(从其中复制的原始碎片)和复制碎片(主碎片的副本)。

可以在创建索引时为每个索引定义碎片和副本的数量。创建索引之后，还可以随时动态更改副本的数量。您可以使用_shrink和_split api更改现有索引的碎片数量，但是这不是一项简单的任务，预先计划正确的碎片数量是最佳方法。

默认情况下，Elasticsearch中的每个索引分配一个主碎片和一个副本，这意味着如果您的集群中至少有两个节点，那么您的索引将有一个主碎片和另一个副本碎片(一个完整的副本)，每个索引总共有两个碎片。